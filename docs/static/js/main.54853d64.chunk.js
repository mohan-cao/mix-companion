(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports=n(31)},17:function(e,t,n){},18:function(e,t,n){},31:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(4),i=n.n(o),s=(n(17),n(5)),c=n(6),l=n(9),u=n(7),p=n(10),m=(n(18),n(8)),h=n.n(m),f=n(1),k=n.n(f),d=n(2),v={"1A":[8,0],"1B":[8,1],"2A":[3,0],"2B":[3,1],"3A":[10,0],"3B":[10,1],"4A":[5,0],"4B":[5,1],"5A":[0,0],"5B":[0,1],"6A":[7,0],"6B":[7,1],"7A":[2,0],"7B":[2,1],"8A":[9,0],"8B":[9,1],"9A":[4,0],"9B":[4,1],"10A":[11,0],"10B":[11,1],"11A":[6,0],"11B":[6,1],"12A":[1,0],"12B":[1,1]};function w(e,t,n){var a=window.crypto.getRandomValues(new Uint32Array(1))[0],r="https://accounts.spotify.com/authorize?response_type=token";return r+="&redirect_uri="+t,r+="&client_id="+e,n&&(r+="&scopes="+(Array.isArray(n)?n.join(" "):n)),r+="&state="+a,new Promise(function(e,t){var n=window.open(r,"Login with Spotify","width=800,height=600");window.spotifyCallback=function(r,o,i){i=parseInt(i),n.close(),i!==a?t("Nonce is invalid, expected: ".concat(a," but got ").concat(i)):e({token:r,expires:o})}})}function y(){return(y=Object(d.a)(k.a.mark(function e(t){var n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/recommendations/available-genre-seeds",e.next=3,fetch("https://api.spotify.com/v1/recommendations/available-genre-seeds",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",Promise.reject());case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(){return(b=Object(d.a)(k.a.mark(function e(t,n){var a,r,o,i,s;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.genres,r=n.bpm,o=n.key,"https://api.spotify.com/v1/recommendations",i="https://api.spotify.com/v1/recommendations?seed_genres="+(Array.isArray(a)?a.join(","):a),i+="&min_key="+v[o][0]+"&max_key="+v[o][0],i+="&min_mode="+v[o][1]+"&max_mode="+v[o][1],i+="&target_tempo="+r,console.log(i),e.next=9,fetch(i,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 9:if(200===(s=e.sent).status){e.next=12;break}return e.abrupt("return",Promise.reject());case 12:return e.abrupt("return",s.json());case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}var g=function(e,t){return e+(t?"B":"A")},A=120,B=1,E=!1,x=["1A","2A","3A","4A","5A","6A","7A","8A","9A","10A","11A","12A"],S=["1B","2B","3B","4B","5B","6B","7B","8B","9B","10B","11B","12B"],j=function(e,t){return 0===e.length?e.push(t):e.push(", ",t),e},C=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={number:B,isMinor:E,token:window.localStorage.getItem("token"),expires:window.localStorage.getItem("expires"),bpmSearch:A,availableGenres:["country","classical","rock","pop","blues","r-n-b"],selectedGenre:"country",results:"Results go here"},e}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=h.a.parse(window.location.hash);if(e){var t=e.access_token,n=e.expires_in,a=e.state;if(window.opener&&window.opener.spotifyCallback)window.opener.spotifyCallback(t,n,a);else if(t&&n){var r=(new Date).getTime()+1e3*parseInt(n)*.9;this.setNewToken(t,r)}window.location.hash=""}}},{key:"setNewToken",value:function(e,t){window.localStorage.getItem("token")!==e&&(window.localStorage.setItem("token",e),window.localStorage.setItem("expires",t),this.setState({token:e,expires:t}))}},{key:"getToken",value:function(){var e=this;w("4a4e5068f705407480266c7e7c8d7dfa","https://www.mohancao.me/mix-companion").then(function(t){var n=t.token,a=t.expires;e.setNewToken(n,a)})}},{key:"setKey",value:function(e){var t,n=(t=e.target.value,[parseInt(t.slice(0,-1)),"b"===t.slice(-1).toLowerCase()]);this.setState({number:n[0]?n[0]:B,isMinor:n[1]?n[1]:E})}},{key:"getGenres",value:function(){var e=this;(function(e){return y.apply(this,arguments)})(this.state.token).then(function(t){return e.setState({availableGenres:t.genres})}).catch(function(){e.getToken()})}},{key:"startSearch",value:function(){var e=this,t=this.state,n=t.token,a=t.selectedGenre,r=t.bpmSearch,o=t.number,i=t.isMinor;(function(e,t){return b.apply(this,arguments)})(n,{genres:a,bpm:r,key:g(o,i)}).then(function(t){return e.setState({results:t})}).catch(function(){e.getToken()})}},{key:"mapResults",value:function(e){if(e&&e.tracks&&!(e.tracks.length<1))return e.tracks.map(function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("h1",null,e.artists.map(function(e,t){return r.a.createElement("a",{key:t,href:e.external_urls.spotify},e.name)}).reduce(j,[])),r.a.createElement("h2",null,r.a.createElement("a",{href:e.external_urls.spotify},e.name)))})}},{key:"render",value:function(){var e=this,t=this.state,n=t.number,a=t.isMinor,o=t.token,i=t.results,s=t.selectedGenre,c=t.availableGenres;return o?r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,g(n,a)),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"key"},"Enter key: "),r.a.createElement("select",{name:"key",value:g(n,a),onChange:function(t){return e.setKey(t)}},r.a.createElement("optgroup",{label:"Minor keys"},x.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})),r.a.createElement("optgroup",{label:"Major keys"},S.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})))),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"bpm"},"Enter BPM: "),r.a.createElement("input",{type:"number",defaultValue:A,name:"bpm",onChange:function(t){return e.setState({bpmSearch:parseFloat(t.target.value?t.target.value:A)})}})),r.a.createElement("div",null,r.a.createElement("select",{value:s,onChange:function(t){return e.setState({selectedGenre:t.target.value})}},c&&c.length>0?c.map(function(e){return r.a.createElement("option",{key:e,value:e},e)}):r.a.createElement("option",null,"No genres available")),r.a.createElement("button",{onClick:function(){return e.getGenres()}},"Fetch all genres")),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.startSearch()}},"Start search")),r.a.createElement("div",null,this.mapResults(i))):r.a.createElement("button",{onClick:function(){return e.getToken()}},"Login to Spotify to use this app")}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.54853d64.chunk.js.map