(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{61:function(e,t,n){e.exports=n(93)},66:function(e,t,n){},67:function(e,t,n){},93:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),i=n.n(o),s=(n(66),n(25)),c=n(26),l=n(28),u=n(27),p=n(29),m=(n(67),n(51)),d=n.n(m),f=n(33),h=n.n(f),y=n(46),g={"1A":[8,0],"1B":[8,1],"2A":[3,0],"2B":[3,1],"3A":[10,0],"3B":[10,1],"4A":[5,0],"4B":[5,1],"5A":[0,0],"5B":[0,1],"6A":[7,0],"6B":[7,1],"7A":[2,0],"7B":[2,1],"8A":[9,0],"8B":[9,1],"9A":[4,0],"9B":[4,1],"10A":[11,0],"10B":[11,1],"11A":[6,0],"11B":[6,1],"12A":[1,0],"12B":[1,1]};function v(e,t,n){var a=window.crypto.getRandomValues(new Uint32Array(1))[0],r="https://accounts.spotify.com/authorize?response_type=token";return r+="&redirect_uri="+t,r+="&client_id="+e,n&&(r+="&scopes="+(Array.isArray(n)?n.join(" "):n)),r+="&state="+a,new Promise(function(e,t){var n=window.open(r,"Login with Spotify","width=800,height=600");window.spotifyCallback=function(r,o,i){i=parseInt(i),n.close(),i!==a?t("Nonce is invalid, expected: ".concat(a," but got ").concat(i)):e({token:r,expires:o})}})}function k(){return(k=Object(y.a)(h.a.mark(function e(t){var n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/recommendations/available-genre-seeds",e.next=3,fetch("https://api.spotify.com/v1/recommendations/available-genre-seeds",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",Promise.reject());case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(){return(w=Object(y.a)(h.a.mark(function e(t,n){var a,r,o,i,s;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.genres,r=n.bpm,o=n.key,"https://api.spotify.com/v1/recommendations",i="https://api.spotify.com/v1/recommendations?seed_genres="+(Array.isArray(a)?a.join(","):a),i+="&min_key="+g[o][0]+"&max_key="+g[o][0],i+="&min_mode="+g[o][1]+"&max_mode="+g[o][1],Array.isArray(r)&&2===r.length?i+="&min_tempo="+r[0]+"&max_tempo="+r[1]:i+="&target_tempo="+r,console.log(i),e.next=9,fetch(i,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 9:if(200===(s=e.sent).status){e.next=12;break}return e.abrupt("return",Promise.reject());case 12:return e.abrupt("return",s.json());case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}var b=n(118),C=n(124),A=n(120),E=n(122),x=n(123),B=n(125),j=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.selectedGenre,n=e.availableGenres,a=e.onChange,o=e.onRefreshClicked,i=e.style;return r.a.createElement(b.a,{style:i},r.a.createElement(C.a,{shrink:!0,htmlFor:"genre"},r.a.createElement("span",null,"Genre"),r.a.createElement("div",{style:{display:"inline"},onClick:function(){return o()}},r.a.createElement(A.a,{style:{height:"0.9rem",fill:"#393"},viewBox:"0 0 24 24"},r.a.createElement("path",{d:"M 9 3 C 8.448 3 8 3.448 8 4 C 8 4.552 8.448 5 9 5 L 18 5 C 18.552 5 19 5.448 19 6 L 19 15 L 17 15 C 16.596 15 16.231172 15.243188 16.076172 15.617188 C 16.025172 15.741187 16 15.871 16 16 C 16 16.26 16.101969 16.516031 16.292969 16.707031 L 19.292969 19.707031 C 19.683969 20.098031 20.317031 20.098031 20.707031 19.707031 L 23.707031 16.707031 C 23.993031 16.421031 24.077828 15.992188 23.923828 15.617188 C 23.768828 15.243187 23.404 15 23 15 L 21 15 L 21 6 C 21 4.343 19.657 3 18 3 L 9 3 z M 4 4 C 3.744125 4 3.4879687 4.0974687 3.2929688 4.2929688 L 0.29296875 7.2929688 C 0.00696875 7.5789687 -0.077828125 8.0078125 0.076171875 8.3828125 C 0.23117187 8.7568125 0.596 9 1 9 L 3 9 L 3 18 C 3 19.657 4.343 21 6 21 L 15 21 C 15.552 21 16 20.552 16 20 C 16 19.448 15.552 19 15 19 L 6 19 C 5.448 19 5 18.552 5 18 L 5 9 L 7 9 C 7.404 9 7.7688281 8.7568125 7.9238281 8.3828125 C 7.9748281 8.2588125 8 8.129 8 8 C 8 7.74 7.8980312 7.4839687 7.7070312 7.2929688 L 4.7070312 4.2929688 C 4.5115312 4.0974687 4.255875 4 4 4 z"})))),r.a.createElement(E.a,{style:{minWidth:70},multiple:!0,input:r.a.createElement(x.a,{name:"genre"}),value:t,onChange:function(e){return a({selectedGenre:e.target.value})}},n&&n.length>0?n.map(function(e){return r.a.createElement(B.a,{key:e,value:e},e.replace(/-/g," "))}):r.a.createElement(B.a,null,"No genres available")))}}]),t}(r.a.PureComponent),L=n(4),S=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,n=e.classes,a=e.camelotKey,o=e.onChange,i=e.style;return r.a.createElement(b.a,{style:i},r.a.createElement(C.a,{shrink:!0,htmlFor:"key"},"Key"),r.a.createElement(E.a,{input:r.a.createElement(x.a,{name:"key"}),name:"key",value:a,onChange:function(e){return o(e)}},r.a.createElement(B.a,{disabled:!0,className:n.group},"Minor keys"),t.camelotMinorKey.map(function(e){return r.a.createElement(B.a,{key:e,className:n.item,value:e},e)}),r.a.createElement(B.a,{disabled:!0,className:n.group},"Major keys"),t.camelotMajorKey.map(function(e){return r.a.createElement(B.a,{key:e,className:n.item,value:e},e)})))}}]),t}(r.a.PureComponent);S.camelotMinorKey=["1A","2A","3A","4A","5A","6A","7A","8A","9A","10A","11A","12A"],S.camelotMajorKey=["1B","2B","3B","4B","5B","6B","7B","8B","9B","10B","11B","12B"];var O=Object(L.a)(function(e){return{item:{paddingLeft:e.spacing(3)},group:{fontWeight:e.typography.fontWeightMedium,opacity:1},MenuItem:{paddingLeft:e.spacing(3)},MenuGroup:{fontWeight:e.typography.fontWeightMedium,opacity:1,cursor:"default","&:hover":{backgroundColor:"transparent !important"}}}})(S),M=n(121),N=n(126),G=function(e,t){return e+(t?"B":"A")},I=120,_=1,W=!1,T=function(e,t){return 0===e.length?e.push(t):e.push(r.a.createElement("br",{key:e.length+1}),t),e},K=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={number:_,isMinor:W,token:window.localStorage.getItem("token"),expires:window.localStorage.getItem("expires"),availableGenres:["country","classical","rock","pop","blues","r-n-b"],selectedGenre:["country"],results:"Results go here",selectedBpm:I},e}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=d.a.parse(window.location.hash);if(e){var t=e.access_token,n=e.expires_in,a=e.state;if(window.opener&&window.opener.spotifyCallback)window.opener.spotifyCallback(t,n,a);else if(t&&n){var r=(new Date).getTime()+1e3*parseInt(n)*.9;this.setNewToken(t,r)}window.location.hash=""}}},{key:"setNewToken",value:function(e,t){window.localStorage.getItem("token")!==e&&(window.localStorage.setItem("token",e),window.localStorage.setItem("expires",t),this.setState({token:e,expires:t}))}},{key:"getToken",value:function(){var e=this;v("4a4e5068f705407480266c7e7c8d7dfa","https://www.mohancao.me/mix-companion").then(function(t){var n=t.token,a=t.expires;e.setNewToken(n,a)})}},{key:"setKey",value:function(e){var t,n=(t=e.target.value,[parseInt(t.slice(0,-1)),"b"===t.slice(-1).toLowerCase()]);this.setState({number:n[0]?n[0]:_,isMinor:n[1]?n[1]:W})}},{key:"getGenres",value:function(){var e=this;(function(e){return k.apply(this,arguments)})(this.state.token).then(function(t){return e.setState({availableGenres:t.genres})}).catch(function(){e.getToken()})}},{key:"startSearch",value:function(){var e=this,t=this.state,n=t.token,a=t.selectedGenre,r=t.selectedBpm,o=t.number,i=t.isMinor;(function(e,t){return w.apply(this,arguments)})(n,{genres:a,bpm:r,key:G(o,i)}).then(function(t){return e.setState({results:t})}).catch(function(){e.getToken()})}},{key:"mapResults",value:function(e){if(e&&e.tracks&&!(e.tracks.length<1))return console.log(e.tracks.sort(function(e,t){return t.popularity-e.popularity})),e.tracks.sort(function(e,t){return t.popularity-e.popularity}).map(function(e){return r.a.createElement("div",{key:e.id,style:{backgroundImage:"url(".concat(e.album?e.album.images[0].url:"",")"),margin:2,backgroundColor:"#999",border:"3px solid #aaa",boxSizing:"content-box"}},r.a.createElement("div",{style:{margin:5,border:"3px solid #aaa",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"50%",height:200,width:200,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},r.a.createElement("h1",{className:"artist-name"},e.artists.map(function(e,t){return r.a.createElement("a",{className:"artist-name",key:t,href:e.external_urls.spotify},e.name)}).reduce(T,[])),r.a.createElement("h2",{className:"song-name"},r.a.createElement("a",{className:"song-name",href:e.external_urls.spotify},e.name))))})}},{key:"handleBpmChange",value:function(e,t){e.shiftKey&&"number"===typeof this.state.selectedBpm?t=[this.state.selectedBpm,t]:Array.isArray(t)&&t[0]===t[1]&&(t=t[0]),console.log(t),this.setState({selectedBpm:t})}},{key:"render",value:function(){var e=this,t=this.state,n=t.number,a=t.isMinor,o=t.token,i=t.results,s=t.selectedGenre,c=t.availableGenres,l=t.selectedBpm;return o?r.a.createElement("div",{className:"App",style:{padding:5}},r.a.createElement("div",{style:{backgroundColor:"#eee",padding:15,display:"inline-flex",flexWrap:"wrap"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("div",null,r.a.createElement(O,{style:{flexDirection:"row",alignItems:"center"},camelotKey:G(n,a),onChange:function(t){return e.setKey(t)}}),r.a.createElement(j,{style:{flexDirection:"row",alignItems:"center",marginLeft:5},selectedGenre:s,availableGenres:c,onChange:function(t){return e.setState(t)},onRefreshClicked:function(){return e.getGenres()}})),r.a.createElement("div",{style:{marginTop:5}},r.a.createElement(M.a,{style:{width:"100%"},color:"primary",variant:"contained",onClick:function(){return e.startSearch()}},"Start search"))),r.a.createElement("div",null,r.a.createElement(C.a,{style:{width:"100%"},shrink:!0,htmlFor:"bpm"},"BPM"),r.a.createElement("div",{style:{display:"flex",height:75}},r.a.createElement(N.a,{name:"bpm",orientation:"vertical",min:0,max:300,value:l,onChange:function(t,n){return e.handleBpmChange(t,n)},valueLabelDisplay:"auto"})))),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",flexWrap:"wrap"}},this.mapResults(i))):r.a.createElement("div",{className:"App"},r.a.createElement(M.a,{onClick:function(){return e.getToken()}},"Login to Spotify to use this app"))}}]),t}(r.a.Component),R=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function D(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(K,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/mix-companion",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/mix-companion","/service-worker.js");R?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):D(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):D(t,e)})}}()}},[[61,1,2]]]);
//# sourceMappingURL=main.727d13a1.chunk.js.map