(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(8),i=n.n(o),s=(n(75),n(19)),c=n(20),l=n(23),u=n(16),p=n(21),m=(n(76),n(57)),f=n.n(m),h=n(31),d=n.n(h),y=n(48),g=n(65),v={"1A":[8,0],"1B":[8,1],"2A":[3,0],"2B":[3,1],"3A":[10,0],"3B":[10,1],"4A":[5,0],"4B":[5,1],"5A":[0,0],"5B":[0,1],"6A":[7,0],"6B":[7,1],"7A":[2,0],"7B":[2,1],"8A":[9,0],"8B":[9,1],"9A":[4,0],"9B":[4,1],"10A":[11,0],"10B":[11,1],"11A":[6,0],"11B":[6,1],"12A":[1,0],"12B":[1,1]};function b(e,t){if(401===e.status)throw e.status;if(200!==e.status){if(t&&t.error&&t.error.message)throw t.error.message;throw e.status}}var k=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"toString",value:function(){return this.message}}]),t}(Object(g.a)(Error));function w(e,t,n){var r=window.crypto.getRandomValues(new Uint32Array(1))[0],a="https://accounts.spotify.com/authorize?response_type=token";return a+="&redirect_uri="+t,a+="&client_id="+e,n&&(a+="&scopes="+(Array.isArray(n)?n.join(" "):n)),a+="&state="+r,new Promise(function(e,t){var n=window.open(a,"Login with Spotify","width=800,height=600");window.spotifyCallback=function(a,o,i){i=parseInt(i),n.close(),i!==r?t("Nonce is invalid, expected: ".concat(r," but got ").concat(i)):e({token:a,expires:o})}})}function x(){return(x=Object(y.a)(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/recommendations/available-genre-seeds",e.next=3,fetch("https://api.spotify.com/v1/recommendations/available-genre-seeds",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 3:if(200===(n=e.sent).status){e.next=6;break}return e.abrupt("return",Promise.reject());case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(e,t,n){return j.apply(this,arguments)}function j(){return(j=Object(y.a)(d.a.mark(function e(t,n,r){var a,o,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",Promise.reject("No search terms provided"));case 2:return a="https://api.spotify.com/v1/search?q="+n+"&type="+r,console.log(a),e.next=6,fetch(a,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 6:return o=e.sent,e.next=9,o.json();case 9:return i=e.sent,b(o,i),e.abrupt("return",i);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function E(){return(E=Object(y.a)(d.a.mark(function e(t,n){var r,a,o,i,s,c,l,u,p,m,f,h,y;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=function(e){if(!Array.isArray(e))throw new k(400);var t=e.map(function(e){return e.hasOwnProperty("tracks")&&e.tracks.items.length?e.tracks.items.map(function(e){return e.id}).slice(0,1).join(""):""}).join(",");if(!t)throw new k("No tracks found using your search terms");return"&seed_tracks="+t},l=function(e){if(!Array.isArray(e))throw new k(400);var t=e.map(function(e){return e.hasOwnProperty("artists")&&e.artists.items.length?e.artists.items.map(function(e){return e.id}).slice(0,1).join(""):""}).join(",");if(!t)throw new k("No artists found using your search terms");return"&seed_artists="+t},c=function(e){return e.replace(/\s*\((.*)\)\s*/g,function(e,t){return' artist:"'.concat(t,'" ')})},r=n.genres,a=n.bpm,o=n.key,i=n.songs,s=n.artist,"https://api.spotify.com/v1/recommendations",p="https://api.spotify.com/v1/recommendations?min_key="+v[o][0]+"&max_key="+v[o][0],p+="&min_mode="+v[o][1]+"&max_mode="+v[o][1],Array.isArray(a)&&2===a.length?p+="&min_tempo="+a[0]+"&max_tempo="+a[1]:p+="&min_tempo="+(a-10)+"&max_tempo="+(a+10),e.prev=8,!i){e.next=16;break}return e.next=12,Promise.all((Array.isArray(i)?i:[i]).map(function(e){return C(t,c(e),"track")}));case 12:m=e.sent,p+=u(m),e.next=28;break;case 16:if(!s){e.next=23;break}return e.next=19,Promise.all((Array.isArray(s)?s:[s]).map(function(e){return C(t,e,"artist")}));case 19:f=e.sent,p+=l(f),e.next=28;break;case 23:if(!r){e.next=27;break}p+="&seed_genres="+(Array.isArray(r)?r.join(","):r),e.next=28;break;case 27:return e.abrupt("return",Promise.reject("No search terms!"));case 28:e.next=37;break;case 30:if(e.prev=30,e.t0=e.catch(8),"number"!==typeof e.t0||400!==e.t0){e.next=36;break}return e.abrupt("return",Promise.reject("Server fucked up"));case 36:return e.abrupt("return",Promise.reject(e.t0));case 37:return console.log(p),e.next=40,fetch(p,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}});case 40:return h=e.sent,e.next=43,h.json();case 43:return y=e.sent,b(h,y),e.abrupt("return",y);case 46:case"end":return e.stop()}},e,null,[[8,30]])}))).apply(this,arguments)}var A=n(134),B=n(143),S=n(136),O=n(140),L=n(137),T=n(145),G=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.selectedGenre,n=e.availableGenres,r=e.onChange,o=e.onRefreshClicked,i=e.style;return a.a.createElement(A.a,{style:i},a.a.createElement(B.a,{shrink:!0,htmlFor:"genre",style:{whiteSpace:"nowrap"}},a.a.createElement("span",{style:{verticalAlign:"top"}},"Genre"),a.a.createElement("div",{style:{display:"inline"},onClick:function(){return o()}},a.a.createElement(S.a,{style:{height:"0.9rem",fill:"#393"},viewBox:"0 0 24 24"},a.a.createElement("path",{d:"M 9 3 C 8.448 3 8 3.448 8 4 C 8 4.552 8.448 5 9 5 L 18 5 C 18.552 5 19 5.448 19 6 L 19 15 L 17 15 C 16.596 15 16.231172 15.243188 16.076172 15.617188 C 16.025172 15.741187 16 15.871 16 16 C 16 16.26 16.101969 16.516031 16.292969 16.707031 L 19.292969 19.707031 C 19.683969 20.098031 20.317031 20.098031 20.707031 19.707031 L 23.707031 16.707031 C 23.993031 16.421031 24.077828 15.992188 23.923828 15.617188 C 23.768828 15.243187 23.404 15 23 15 L 21 15 L 21 6 C 21 4.343 19.657 3 18 3 L 9 3 z M 4 4 C 3.744125 4 3.4879687 4.0974687 3.2929688 4.2929688 L 0.29296875 7.2929688 C 0.00696875 7.5789687 -0.077828125 8.0078125 0.076171875 8.3828125 C 0.23117187 8.7568125 0.596 9 1 9 L 3 9 L 3 18 C 3 19.657 4.343 21 6 21 L 15 21 C 15.552 21 16 20.552 16 20 C 16 19.448 15.552 19 15 19 L 6 19 C 5.448 19 5 18.552 5 18 L 5 9 L 7 9 C 7.404 9 7.7688281 8.7568125 7.9238281 8.3828125 C 7.9748281 8.2588125 8 8.129 8 8 C 8 7.74 7.8980312 7.4839687 7.7070312 7.2929688 L 4.7070312 4.2929688 C 4.5115312 4.0974687 4.255875 4 4 4 z"})))),a.a.createElement(O.a,{style:{minWidth:70,flex:1},multiple:!0,input:a.a.createElement(L.a,{name:"genre"}),value:t,onChange:function(e){return r(e.target.value)}},n&&n.length>0?n.map(function(e){return a.a.createElement(T.a,{key:e,value:e},e.replace(/-/g," "))}):a.a.createElement(T.a,null,"No genres available")))}}]),t}(a.a.PureComponent),M=n(4),N=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,n=e.classes,r=e.camelotKey,o=e.onChange,i=e.style;return a.a.createElement(A.a,{style:i},a.a.createElement(B.a,{shrink:!0,htmlFor:"key"},"Key"),a.a.createElement(O.a,{input:a.a.createElement(L.a,{name:"key"}),name:"key",value:r,onChange:function(e){return o(e)}},a.a.createElement(T.a,{disabled:!0,className:n.group},"Minor keys"),t.camelotMinorKey.map(function(e){return a.a.createElement(T.a,{key:e,className:n.item,value:e},e)}),a.a.createElement(T.a,{disabled:!0,className:n.group},"Major keys"),t.camelotMajorKey.map(function(e){return a.a.createElement(T.a,{key:e,className:n.item,value:e},e)})))}}]),t}(a.a.PureComponent);N.camelotMinorKey=["1A","2A","3A","4A","5A","6A","7A","8A","9A","10A","11A","12A"],N.camelotMajorKey=["1B","2B","3B","4B","5B","6B","7B","8B","9B","10B","11B","12B"];var P=Object(M.a)(function(e){return{item:{paddingLeft:e.spacing(3)},group:{fontWeight:e.typography.fontWeightMedium,opacity:1},MenuItem:{paddingLeft:e.spacing(3)},MenuGroup:{fontWeight:e.typography.fontWeightMedium,opacity:1,cursor:"default","&:hover":{backgroundColor:"transparent !important"}}}})(N),I=n(139),W=n(146),_=n(47);function R(e){var t=e.min,n=e.max,o=e.height,i=e.selectedBpm,s=e.onBpmChange,c=e.onLongPress;return a.a.createElement("div",null,a.a.createElement(B.a,{style:{width:"100%"},shrink:!0},"BPM"),a.a.createElement("div",{style:{display:"flex",height:o}},a.a.createElement(W.a,Object.assign({},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=Object(r.useState)(!1),a=Object(_.a)(n,2),o=a[0],i=a[1];return Object(r.useEffect)(function(){var n;return o?n=setTimeout(e,t):clearTimeout(n),function(){clearTimeout(n)}},[e,t,o]),{onMouseDown:function(){return i(!0),!0},onMouseUp:function(){return i(!1),!0},onMouseLeave:function(){return i(!1),!0},onTouchStart:function(){return i(!0),!0},onTouchEnd:function(){return i(!1),!0}}}(c,500),{orientation:"vertical",min:t,max:n,value:i,onChange:function(e,t){return s(e,t)},valueLabelDisplay:"auto"}))))}var D=n(141),K={Track:"Never Gonna Give You Up, Robot Rock",Artist:"Kanye West",Genre:"Pop, Rock, Country"},q=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.style,n=e.type,r=e.value,o=e.onChange,i=e.GenreSelector,s=t.flex?{flex:t.flex}:{flexGrow:t.flexGrow,flexBasis:t.flexBasis,flexShrink:t.flexShrink};return a.a.createElement(A.a,{style:t},a.a.createElement(B.a,{shrink:!0,style:{whiteSpace:"nowrap"}},"Type"),a.a.createElement(O.a,{value:n,onChange:function(e){return o({type:e.target.value})},style:{marginRight:5}},a.a.createElement(T.a,{value:"Track"},"Track"),a.a.createElement(T.a,{value:"Artist"},"Artist"),a.a.createElement(T.a,{value:"Genre"},"Genre")),"Genre"===n?i:a.a.createElement(D.a,{value:r,onChange:function(e){return o({query:e.target.value})},style:s,placeholder:K[n],InputLabelProps:{shrink:!0,disableAnimation:!1},label:"Search"}))}}]),t}(a.a.PureComponent);q.defaultProps={type:"Track"};var z=n(63),U=function(e){var t=e.childrenWidth,n=e.children,r=Object(z.a)(),o=Object(_.a)(r,2),i=o[0],s=o[1];return a.a.createElement("div",{ref:i,style:{width:"100%",display:"flex",justifyContent:"center"}},a.a.createElement("div",{style:{width:Math.floor(s/t)*t+1,display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",flexWrap:"wrap"}},n))};function F(e){var t=e.data;return!t||!t.tracks||t.tracks.length<1?a.a.createElement("div",null):t.tracks.sort(function(e,t){return t.popularity-e.popularity}).map(function(e){return a.a.createElement("div",{key:e.id,style:{backgroundImage:"url(".concat(e.album?e.album.images[0].url:"",")"),margin:2,backgroundColor:"#999",border:"2px solid #aaa",boxSizing:"content-box"}},a.a.createElement("div",{style:{margin:5,border:"0.5px solid #aaa",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"50%",height:200,width:200,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},a.a.createElement("h1",{className:"artist-name"},e.artists.map(function(e,t){return a.a.createElement("a",{className:"artist-name",key:e.id+""+t,href:e.external_urls.spotify},e.name)}).reduce(X,[])),a.a.createElement("h2",{className:"song-name"},a.a.createElement("a",{className:"song-name",href:e.external_urls.spotify},e.name))))})}var J=n(142);function H(e){var t=e.open,n=e.error,r=e.onClose;return a.a.createElement(J.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:t,onClose:r,autoHideDuration:6e3,ContentProps:{"aria-describedby":"message-id"},message:a.a.createElement("span",{id:"message-id"},"Error: ",n," ")})}var V=function(e,t){return e+(t?"B":"A")},Y=120,$=1,Q=!1,X=function(e,t){return 0===e.length?e.push(t):e.push(a.a.createElement("br",{key:e.length+1}),t),e},Z=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={number:$,isMinor:Q,token:window.localStorage.getItem("token"),expires:window.localStorage.getItem("expires"),availableGenres:["country","classical","rock","pop","blues","r-n-b"],results:"Results go here",selectedBpm:Y,type:"Track",query:""},e}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=f.a.parse(window.location.hash);if(e){var t=e.access_token,n=e.expires_in,r=e.state;if(window.opener&&window.opener.spotifyCallback)window.opener.spotifyCallback(t,n,r);else if(t&&n){var a=(new Date).getTime()+1e3*parseInt(n)*.9;this.setNewToken(t,a)}window.history.replaceState(null,null," ")}}},{key:"setNewToken",value:function(e,t){window.localStorage.getItem("token")!==e&&(window.localStorage.setItem("token",e),window.localStorage.setItem("expires",t),this.setState({token:e,expires:t}))}},{key:"getToken",value:function(){var e=this;w("4a4e5068f705407480266c7e7c8d7dfa","https://www.mohancao.me/mix-companion").then(function(t){var n=t.token,r=t.expires;e.setNewToken(n,r)})}},{key:"setKey",value:function(e){var t,n=(t=e.target.value,[parseInt(t.slice(0,-1)),"b"===t.slice(-1).toLowerCase()]);this.setState({number:n[0]?n[0]:$,isMinor:n[1]?n[1]:Q})}},{key:"getGenres",value:function(){var e=this;(function(e){return x.apply(this,arguments)})(this.state.token).then(function(t){return e.setState({availableGenres:t.genres})}).catch(function(t){401===t?e.getToken():e.setState({error:""+t})})}},{key:"startSearch",value:function(){var e=this,t=this.state,n=t.token,r=t.selectedBpm,a=t.number,o=t.isMinor,i=t.type,s=t.query,c="";"Genre"===i&&s&&s.length&&s.length>5&&(c+="Sorry, can't have more than 5 genres. "),c?this.setState({error:c}):function(e,t){return E.apply(this,arguments)}(n,{genres:"Genre"===i?s:null,bpm:r,key:V(a,o),songs:"Track"===i?s.split(",").map(function(e){return e.trim()}):null,artist:"Artist"===i?s.split(",").map(function(e){return e.trim()}):null}).then(function(t){return e.setState({results:t})}).catch(function(t){401===t?e.getToken():e.setState({error:""+t})})}},{key:"handleBpmChange",value:function(e,t){e.shiftKey&&"number"===typeof this.state.selectedBpm?t=[this.state.selectedBpm,t]:Array.isArray(t)&&t[0]===t[1]&&(t=t[0]),this.setState({selectedBpm:t})}},{key:"setSearchTerms",value:function(e){var t=e.query,n=e.type;n?this.setState({type:n,query:""}):this.setState({query:t})}},{key:"render",value:function(){var e=this,t=this.state,n=t.number,r=t.isMinor,o=t.token,i=t.results,s=t.availableGenres,c=t.selectedBpm,l=t.type,u=t.query,p=t.error;return o?a.a.createElement("div",{className:"App"},a.a.createElement(H,{open:!!p,error:p,onClose:function(){return e.setState({error:null})}}),a.a.createElement("div",{style:{backgroundColor:"#eee",padding:15,boxSizing:"border-box",display:"inline-flex",width:"100vw",justifyContent:"center",flexWrap:"wrap"}},a.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"70%",flex:"1 1 auto",overflow:"auto"}},a.a.createElement("div",{style:{display:"flex"}},a.a.createElement(P,{style:{flexDirection:"row",flex:"0 0 auto",alignItems:"center"},camelotKey:V(n,r),onChange:function(t){return e.setKey(t)}}),a.a.createElement(q,{style:{flexDirection:"row",flex:"1 1 150px",minWidth:"150px",alignItems:"center",marginLeft:5},type:l,value:u,onChange:function(t){return e.setSearchTerms(t)},GenreSelector:a.a.createElement(G,{style:{flexDirection:"row",flex:"1 1 auto",alignItems:"center",marginLeft:5},selectedGenre:"Genre"===l&&Array.isArray(u)?u:[],availableGenres:s,onChange:function(t){return t.length<=5&&e.setState({query:t})},onRefreshClicked:function(){return e.getGenres()}})})),a.a.createElement("div",{style:{marginTop:5}},a.a.createElement(I.a,{style:{width:"100%"},color:"primary",variant:"contained",onClick:function(){return e.startSearch()}},"Start search"))),a.a.createElement("div",{style:{flex:"0 1 auto"}},a.a.createElement(R,{onLongPress:function(){return e.handleBpmChange({},[50,250])},selectedBpm:c,onBpmChange:function(t,n){return e.handleBpmChange(t,n)},height:75,min:0,max:300}))),a.a.createElement("div",{style:{marginTop:5}},"Getting recommendations for ",l.toLowerCase(),"s ",a.a.createElement("span",{style:{color:"red"}},u?"like "+(Array.isArray(u)?u.join(", "):u):"")),a.a.createElement("div",{style:{padding:"20px 0",display:"flex",justifyContent:"center"}},a.a.createElement(U,{childrenWidth:219},a.a.createElement(F,{data:i})))):a.a.createElement("div",{className:"App",style:{display:"flex",justifyContent:"center",alignItems:"center"}},a.a.createElement(I.a,{onClick:function(){return e.getToken()}},"Login to Spotify to use this app"))}}]),t}(a.a.Component),ee=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function te(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(a.a.createElement(Z,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/mix-companion",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/mix-companion","/service-worker.js");ee?(function(e,t){fetch(e).then(function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):te(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):te(t,e)})}}()},70:function(e,t,n){e.exports=n(102)},75:function(e,t,n){},76:function(e,t,n){}},[[70,1,2]]]);
//# sourceMappingURL=main.e631542c.chunk.js.map